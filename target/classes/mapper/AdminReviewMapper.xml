<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.AdminReviewMapper">

    <select id="countAll" resultType="int">
        SELECT COUNT(*) FROM reviews
    </select>

    <!-- 최신 리뷰가 위로: created_at DESC -->
    <select id="findPage" resultType="map">
        SELECT
            r.review_id                                      AS "reviewId",
            r.book_id                                        AS "bookId",
            b.title                                          AS "bookTitle",
            b.cover_image                                    AS "coverImage",
            r.user_id                                        AS "userId",
            u.name                                           AS "userName",
            -- 문자열로 뽑아 UI에서 그대로 출력
            TO_CHAR(r.created_at, 'YYYY-MM-DD HH24:MI:SS')   AS "createdAt",
            r.content                                        AS "content"
        FROM reviews r
                 JOIN books  b ON b.book_id = r.book_id
                 JOIN users  u ON u.user_id = r.user_id
        ORDER BY r.created_at DESC
        OFFSET #{offset} ROWS FETCH NEXT #{size} ROWS ONLY
    </select>

    <delete id="deleteById">
        DELETE FROM reviews WHERE review_id = #{reviewId}
    </delete>
</mapper>
